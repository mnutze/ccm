(()=>{const e={},t=function(){const e=[];let t,o;function a(){return r.transaction([t.name],"readwrite").objectStore(t.name)}function s(e={}){return t.db&&(e.db=t.db),e.store=t.name,(o=n.context.find(t,"user"))&&o.isLoggedIn()&&(e.realm=o.getRealm(),e.token=o.data().token),e}async function c(e,t){if(401===e.data.status&&o)try{await o.logout(),await o.login(),await n.context.root(o).start()}catch(e){await n.context.root(o).start()}else t(e)}function i(r){return new Promise(o=>{const a=n.helper.generateKey();e[a]=o,r.callback=a,t.socket.send(n.helper.stringify(r))})}function l(e){return n.load({url:t.url,params:e,method:t.method})}this.init=(async()=>{t=this,await async function(){if(!t.name||t.url)return;await new Promise(e=>r?e():indexedDB.open("ccm").onsuccess=function(){r=this.result,e()}),await new Promise(e=>{if(r.objectStoreNames.contains(t.name))return e();let n=parseInt(localStorage.getItem("ccm"));n||(n=1),r.close();const o=indexedDB.open("ccm",n+1);o.onupgradeneeded=function(){r=this.result,localStorage.setItem("ccm",r.version),r.createObjectStore(t.name,{keyPath:"key"})},o.onsuccess=e})}(),await new Promise(r=>{if(!t.url||0!==t.url.indexOf("ws"))return r();!t.onchange&&t.parent&&(t.onchange=t.parent.start);let o=[t.db,t.name];t.dataset&&(Array.isArray(t.dataset)||(t.dataset=[t.dataset]),o=o.concat(t.dataset)),t.socket=new WebSocket(t.url,"ccm-cloud"),t.socket.onmessage=(r=>{const{callback:o,data:a}=n.helper.parse(r.data);o?(e[o](a),delete e[o]):t.onchange&&t.onchange(a)}),t.socket.onopen=(()=>{t.socket.send(o),r()})}),delete t.init}),this.clear=(()=>t.local={}),this.source=(()=>({name:t.name,url:t.url,db:t.db})),this.get=((e={})=>new Promise((r,o)=>{e=n.helper.clone(e),n.helper.isObject(e)||n.helper.isKey(e)||o(new Error("invalid dataset key: "+e)),t.url?(t.socket?i:l)(s({get:e})).then(r).catch(e=>c(e,o)):t.name?function(){const t=a(),s=n.helper.isObject(e)?t.getAll():t.get(e);s.onsuccess=(e=>r(e.target.result||null)),s.onerror=(e=>o(e.target.errorCode))}():function(){r(n.helper.clone(n.helper.isObject(e)?function(e){const r=[];for(const o in t.local)n.helper.isSubset(e,t.local[o])&&r.push(t.local[o]);return r}(e):t.local[e]))}()})),this.set=(e=>new Promise((r,o)=>{(e=n.helper.toJSON(e)).key||(e.key=n.helper.generateKey()),n.helper.isKey(e.key)||o(new Error("invalid dataset key: "+e.key)),t.url?(t.socket?i:l)(s({set:e})).then(t=>(t.toString()===e.key.toString()?r:o)(t)).catch(e=>c(e,o)):t.name?function(){const t=a().put(e);t.onsuccess=(t=>t.target.result.toString()===e.key.toString()?r(t.target.result):o(t.target.result)),t.onerror=(e=>o(e.target.errorCode))}():async function(){t.local[e.key]?t.local[e.key]=await n.helper.integrate(e,t.local[e.key]):t.local[e.key]=e;r(e.key)}()})),this.del=(e=>new Promise((r,o)=>{n.helper.isKey(e)||o(new Error("invalid dataset key: "+e)),t.url?(t.socket?i:l)(s({del:e})).then(e=>(!0===e?r:o)(e)).catch(e=>c(e,o)):t.name?function(){const t=a().delete(e);t.onsuccess=(e=>void 0===e.target.result?r(!0):o(e.target.result)),t.onerror=(e=>o(e.target.errorCode))}():(delete t.local[e],r(!0))}))};let r;window.ccm||(ccm={callbacks:{},files:{}});const n={version:()=>"24.0.5",components:{},load:function(){const e=[...arguments],t=e.slice(0);t.unshift(n.load);let r=[],o=1,a=!1;return new Promise((s,c)=>{function i(){--o||(1===r.length&&(r=r[0]),(a?c:s)(r))}e.forEach((e,s)=>{if(o++,e=n.helper.clone(e),Array.isArray(e))return r[s]=[],void function t(o){null!==o&&r[s].push(o);if(0===e.length)return i();let a=e.shift();Array.isArray(a)||(a=[a]);n.load.apply(null,a).then(t).catch(t)}(null);n.helper.isObject(e)||(e={url:e});const c=e.url.split(".").pop().split("?").shift().toLowerCase();e.method&&(e.method=e.method.toLowerCase()),e.context&&"head"!==e.context||(e.context=document.head),n.helper.isInstance(e.context)&&(e.context=e.context.element.parentNode);const l=function(){switch(e.type){case"html":return u;case"image":return d;case"css":return h;case"js":return f;case"module":return m;case"xml":return y;case"data":return g}switch(c){case"html":return u;case"jpg":case"jpeg":case"gif":case"png":case"svg":case"bmp":return d;case"css":return h;case"js":return f;case"mjs":return m;case"xml":return y;default:return g}}();let p;function u(){e.type="html",e.method="get",g()}function d(){const t=new Image;t.onload=w,t.onerror=(e=>k(t,e)),t.src=e.url}function h(){if(e.context.querySelector('link[rel="stylesheet"][type="text/css"][href="'+e.url+'"]'))return w();let t={tag:"link",rel:"stylesheet",type:"text/css",href:e.url};e.attr&&(t=Object.assign(t,e.attr)),(t=n.helper.html(t)).onload=w,t.onerror=(e=>{n.helper.removeElement(t),k(t,e)}),e.context.appendChild(t)}function f(){const t=e.url.split("/").pop().split("?").shift().replace(".min.",".");ccm.files[t]=null,ccm.files["#"+t]=ccm.files["#"+t]?ccm.files["#"+t]+1:1;let r={tag:"script",src:e.url};e.attr&&(r=Object.assign(r,e.attr)),(r=n.helper.html(r)).onload=(()=>{const e=ccm.files[t];--ccm.files["#"+t]||(delete ccm.files[t],delete ccm.files["#"+t]),n.helper.removeElement(r),null!==e?b(e):w()}),r.onerror=(e=>{n.helper.removeElement(r),k(r,e)}),e.context.appendChild(r)}function m(){const t="callback"+n.helper.generateKey();ccm.callbacks[t]=function(e){n.helper.removeElement(r),delete ccm.callbacks[t],b(e)};const r=n.helper.html({tag:"script",type:"module"});r.onerror=(e=>{n.helper.removeElement(r),k(r,e)}),r.text="import * as alias from '"+e.url+"'; ccm.callbacks['"+t+"']( alias"+(e.import?"."+e.import:"")+" )",document.head.appendChild(r)}function y(){e.method||(e.method="post");const t=new XMLHttpRequest;t.onreadystatechange=(()=>{4===t.readyState&&(200===t.status?b(t.responseXML):k(t))}),t.open(e.method,e.url,!0),t.send()}function g(){switch(e.method){case"jsonp":!function(){const t="callback"+n.helper.generateKey();e.params||(e.params={});e.params.callback="ccm.callbacks."+t,ccm.callbacks[t]=(e=>{n.helper.removeElement(o),delete ccm.callbacks[t],b(e)});let o={tag:"script",src:r(e.url,e.params)};e.attr&&(o=Object.assign(o,e.attr));(o=n.helper.html(o)).onerror=(e=>{n.helper.removeElement(o),k(o,e)}),o.src=o.src.replace(/&amp;/g,"&"),e.context.appendChild(o)}();break;case"get":case"post":case"put":case"delete":t();break;case"fetch":!function(){e.init||(e.init={});e.params&&("post"===e.init.method.toLowerCase()?e.init.body=n.helper.stringify(e.params):e.url=r(e.url,e.params));fetch(e.url,e.init).then(e=>e.text()).then(b).catch(k)}();break;default:e.method="post",t()}function t(){const t=new XMLHttpRequest;if(t.open(e.method,"get"===e.method&&e.params?r(e.url,e.params):e.url,!0),e.headers)for(const r in e.headers)t.setRequestHeader(r,e.headers[r]),"authorization"===r.toLowerCase()&&(t.withCredentials=!0);("post"===e.method||"put"===e.method)&&t.setRequestHeader("Content-Type","application/json"),t.onreadystatechange=(()=>{4===t.readyState&&(t.status>=200&&t.status<300?b(t.responseText):k(t))}),t.send("post"===e.method||"put"===e.method?n.helper.stringify(e.params):void 0)}function r(e,t){return n.helper.isObject(t.json)&&(t.json=n.helper.stringify(t.json)),t?e+"?"+function e(t,r){let n="";for(const o in t){const a=r?r+"["+encodeURIComponent(o)+"]":encodeURIComponent(o);"object"==typeof t[o]?n+=e(t[o],a):n+=a+"="+encodeURIComponent(t[o])+"&"}return n}(t).slice(0,-1):e}}function b(t){if(!v()){if("string"==typeof t&&n.helper.regex("json").test(t))try{t=n.helper.parse(t)}catch(e){}"html"===e.type&&(t=n.helper.html2json(t)),r[s]=n.helper.protect(t),w()}}function w(){v()||(void 0===r[s]&&(r[s]=e.url),i())}function v(){return p?n.helper.log("loading of "+e.url+" succeeded after timeout ("+n.load.timeout+"ms)")||!0:p=!1}function k(){a=!0,r[s]={error:new Error("loading of "+e.url+" failed"),resource:e,data:[...arguments],call:t},r[s].data.length<=1&&(r[s].data=r[s].data[0]),i()}n.load.timeout&&n.helper.wait(n.load.timeout,()=>void 0===p&&(p=!0)&&k("timeout")),l()}),i()})},component:async(t,r)=>{if(t=await async function(){if("string"==typeof t){const r=n.helper.getIndex(t);if(e[r])return n.helper.clone(e[r]);if(n.helper.regex("filename").test(t.split("/").pop())){const e=await n.load(t);return e.url=t,e}return new Error("invalid component index or URL: "+t)}return t}(),!n.helper.isComponent(t))return new Error("invalid component object");await async function(e,t){const r=t&&t.ccm;r&&(e.ccm=ccm[(await n.helper.loadFramework(r)).version()],e.ccm.url=n.helper.isObject(r)?r.url:r,t&&delete t.ccm)}(t,r);const s=(n.helper.isFramework(t.ccm)?t.ccm:await n.helper.loadFramework(t.ccm)).version();return s!==n.version()?new Promise(async e=>{const n=await ccm[s].component(t,r,e);n&&e(n)}):(t.index=t.name+(t.version?"-"+t.version.join("-"):""),e[t.index]?t=e[t.index]:(e[t.index]=t,n.components[t.index]={},t.instances=0,t.ccm=ccm[s],t.ready&&await t.ready.call(t),delete t.ready,await o(t.index)),(t=n.helper.clone(t)).config=await a(r,t.config),t.instance=(async e=>await n.instance(t,await a(e,t.config))),t.start=(async e=>await n.start(t,await a(e,t.config))),t)},instance:async(t,r)=>{if(r&&r.root&&n.helper.setContent(r.root,n.helper.loading(r.parent)),t=await n.component(t,{ccm:r&&r.ccm}),r&&delete r.ccm,!n.helper.isComponent(t))return t;if(t.ccm.version()!==n.version())return new Promise(async e=>{const n=await ccm[t.ccm.version()].instance(t,r,e);n&&e(n)});r=await a(r,t.config);let o=function(){const o=new t.Instance;o.ccm=t.ccm,o.component=t,o.parent=r.parent,delete r.parent,o.root=r.root,delete r.root,o.id=++e[t.index].instances,o.index=t.index+"-"+o.id,function(){if("parent"===o.root&&o.parent)return o.root=o.parent.root,void(o.element=o.parent.element);"string"==typeof o.root&&(o.root=o.parent.element.querySelector("#"+("name"===o.root&&o.parent?t.name:o.root)));const e=n.helper.html({id:o.index});let a;o.root&&n.helper.setContent(o.root,e),o.root=e,r.shadow||(r.shadow="closed"),"string"==typeof r.shadow&&"none"!==r.shadow&&(a=e.shadowRoot||e.attachShadow({mode:r.shadow}),delete r.shadow),n.helper.setContent(a||e,o.element=n.helper.html({id:"element"})),o.start&&n.helper.setContent(o.element,n.helper.loading(o))}(),o.init||(o.init=(async()=>{}));o.root.id===o.index&&o.root.parentNode&&0===o.root.parentNode.tagName.indexOf("CCM-")&&function(){o.update||(o.update=((e,t)=>{switch(e){case"ccm":case"component":case"config":case"element":case"id":case"index":case"init":case"onfinish":case"parent":case"ready":case"root":case"start":case"update":break;case"key":if(n.helper.regex("json").test(t)&&(t=n.helper.parse(t)),n.helper.isObject(t))for(const e in t)if(t.hasOwnProperty(e))switch(e){case"ccm":case"component":case"dependency":case"parent":case"id":case"index":case"element":case"root":case"init":case"ready":case"start":case"update":case"key":break;default:o[e]=t[e]}o.start();break;default:o[e]=t,o.start()}}));new(window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver)(e=>e.forEach(e=>{if("attributes"!==e.type)return;const t=e.attributeName,r=o.root.parentNode.getAttribute(t);o.update(t,r)})).observe(o.root.parentNode,{attributes:!0})}();return o}();return o.config=n.helper.stringify(r),document.contains(o.root)||(o.root.position=document.createElement("div"),o.root.parentNode&&o.root.parentNode.replaceChild(o.root.position,o.root),document.head.appendChild(o.root)),r=await n.helper.solveDependencies(r,o),document.head.contains(o.root)&&(document.head.removeChild(o.root),o.root.position.parentNode&&o.root.position.parentNode.replaceChild(o.root,o.root.position),delete o.root.placeholder),r.inner=n.helper.html(r.inner,void 0,{no_evaluation:!0}),Object.assign(o,r),o.parent&&o.parent.init||await new Promise(e=>{const t=[o];!function e(r){const o=[];for(const e in r)if(r.hasOwnProperty&&r.hasOwnProperty(e)){const a=r[e];if(n.helper.isInstance(a)&&"parent"!==e&&!n.helper.isProxy(a))t.push(a),o.push(a);else if(Array.isArray(a)||n.helper.isObject(a)){if(n.helper.isSpecialObject(a))continue;o.push(a)}}o.map(e)}(o);let r=0;!function n(){if(r===t.length)return function r(){if(!t.length)return e();const n=t.pop();n.ready?n.ready().then(()=>{delete n.ready,r()}):r(),n._start&&(delete n._start,n.start())}();const o=t[r++];o.init?o.init().then(()=>{delete o.init,n()}):n()}()}),o},proxy:async(e,t)=>{const r={ccm:!0,component:{Instance:!0},start:async o=>await Object.assign(r,await n.instance(e,await n.helper.integrate(o,t))).start()};return r},start:async(e,t)=>{const r=await n.instance(e,t);return n.helper.isInstance(r)?(r.init?r._start=!0:await r.start(),r):r},store:e=>new Promise((r,o)=>{"string"==typeof(e=n.helper.clone(e))&&(e=e.split("?").shift().endsWith(".js")?{local:["ccm.load",e]}:{name:e}),n.helper.isObject(e)&&(e.local||e.name)||delete(e={local:e,parent:e.parent}).local.parent,e.local||e.name||(e.local={}),n.helper.solveDependency(e.local).then(o=>{e.local=o,Array.isArray(e.local)&&(e.local=n.helper.arrToStore(e.local));let a=new t;Object.assign(a,e),a.init().then(()=>r(a))}).catch(o)}),get:(e,t)=>n.store(e).then(e=>{let r;return"string"==typeof t&&(r=t.split("."),t=r.shift(),r=r.join(".")),e.get(t).then(e=>r?n.helper.deepValue(e,r):e)}),set:(e,t)=>n.store(e).then(e=>e.set(t)),del:(e,t)=>n.store(e).then(e=>e.del(t)),context:{find:(e,t,r)=>{const o=e;r&&(e=e.parent);do{if(n.helper.isObject(e)&&void 0!==e[t]&&e[t]!==o)return e[t]}while(e=e.parent)},highestByProperty:(e,t,r)=>{const o=e;let a=null;r&&(e=e.parent);do{n.helper.isObject(e)&&void 0!==e[t]&&e[t]!==o&&(a=e)}while(e=e.parent);return a},nearestByProperty:(e,t,r)=>{const o=e;r&&(e=e.parent);do{if(n.helper.isObject(e)&&void 0!==e[t]&&e[t]!==o)return e}while(e=e.parent);return null},root:function(e){for(;e.parent;)e=e.parent;return e}},helper:{action:function(e,t){return"function"==typeof e?e():(Array.isArray(e)||(e=e.split(" ")),n.helper.isObject(e[0])?new Promise(t=>n.load({url:e[0].module,type:"module",import:e[0].import}).then(r=>t(r.apply(window,e.slice(1))))):"function"==typeof e[0]?e[0].apply(window,e.slice(1)):0===e[0].indexOf("this.")?this.executeByName(e[0].substr(5),e.slice(1),t):this.executeByName(e[0],e.slice(1)))},append:function(e,t){t=n.helper.protect(t),e.appendChild(t)},arrToObj:function(e,t){var r=t?e[t]:e;if(Array.isArray(r)){var n={};return r.map(function(e){n[e]=!0}),t&&(e[t]=n),n}},arrToStore:e=>{if(!Array.isArray(e))return;const t={};return e.forEach(e=>{n.helper.isDataset(e)&&(t[e.key]=e)}),t},asyncForEach:async function(e,t){for(let r=0;r<e.length;r++)await t(e[r],r,e)},cleanObject:function(e){for(var t in e)e[t]?"object"!=typeof e[t]||n.helper.isNode(e[t])||n.helper.isInstance(e[t])||n.helper.cleanObject(e[t]):delete e[t];return e},clone:function(e){return function e(t,r){if(n.helper.isSpecialObject(t)&&!r)return t;if(Array.isArray(t)||n.helper.isObject(t)){var o=Array.isArray(t)?[]:{};for(var a in t)o[a]=e(t[a]);return o}return t}(e,!0)},compareVersions:(e,t)=>{if(e===t)return 0;const r=e.split("."),n=t.split(".");for(let e=0;e<3;e++){const t=parseInt(r[e]),o=parseInt(n[e]);if(t<o)return-1;if(t>o)return 1}return 0},convertObjectKeys:function(e){return Object.keys(e).map(function(t){-1!==t.indexOf(".")&&(n.helper.deepValue(e,t,e[t]),delete e[t])}),e},dataset:async function(e={}){if(n.helper.isDatastore(e)&&(e={store:e}),!(e=n.helper.clone(e))||!n.helper.isDatastore(e.store))return e;if(!e.key&&n.helper.isKey(arguments[1])&&(e.key=arguments[1]),e.key||(e.key=n.helper.generateKey()),n.helper.isDataset(e.key))return e.convert?await e.convert(e.key):e.key;const t=n.context.find(e.store,"user");t&&e.login&&await t.login(),n.helper.isInstance(t)&&e.user&&t.isLoggedIn()&&(e.key=[e.key,t.data().user]);let r=await e.store.get(e.key);return r||(r={key:e.key},e.permissions&&(r._=e.permissions)),e.convert&&(r=await e.convert(r)),r},decodeObject:e=>{if("string"==typeof e)return e=e.replace(/'/g,'"'),n.helper.regex("json").test(e)&&(e=n.helper.parse(e)),e;if("object"==typeof e&&!n.helper.isNode(e)&&!n.helper.isInstance(e))for(const t in e)e[t]=n.helper.decodeObject(e[t]);return e},deepValue:function(e,t,r){return function e(t,r,n){if(!t)return;var o=r.shift();if(0===r.length)return void 0!==n?t[o]=n:t[o];t[o]||void 0===n||(t[o]=isNaN(r[0])?{}:[]);return e(t[o],r,n)}(e,t.split("."),r)},encodeObject:(e,t)=>{if("object"!=typeof e)return e;if(!t)return n.helper.stringify(e).replace(/"/g,"'");for(const t in e)"object"==typeof e[t]&&(e[t]=n.helper.stringify(e[t]).replace(/"/g,"'"));return e},encodeDependencies:e=>{if(n.helper.isDependency(e))return n.helper.stringify(e).replace(/"/g,"'");if("object"!=typeof e||n.helper.isNode(e)||n.helper.isInstance(e))return e;for(const t in e)e[t]=n.helper.encodeDependencies(e[t]);return e},escapeHTML:e=>{const t=document.createTextNode(e),r=document.createElement("div");return r.appendChild(t),r.innerHTML},executeByName:function(e,t,r){r||(r=window);var n=e.split(".");e=n.pop();for(var o=0;o<n.length;o++)r=r[n[o]];return r[e].apply(r,t)},fillForm:(e,t)=>{t=n.helper.clone(n.helper.protect(t));const r=n.helper.toDotNotation(t,!0);for(const e in r)t[e]=r[e];for(const r in t)t[r]&&("object"==typeof t[r]&&(t[r]=n.helper.encodeObject(t[r])),"string"==typeof t[r]&&(t[r]=n.helper.unescapeHTML(t[r])),[...e.querySelectorAll('[name="'+r+'"]')].map(e=>{"checkbox"===e.type?e.value&&"string"==typeof t[r]&&"["===t[r].charAt(0)?n.helper.decodeObject(t[r]).map(t=>{t===e.value&&(e.checked=!0)}):e.checked=!0:"radio"===e.type?t[r]===e.value&&(e.checked=!0):"select"===e.tagName.toLowerCase()?(e.hasAttribute("multiple")&&(t[r]=n.helper.decodeObject(t[r])),[...e.querySelectorAll("option")].map(o=>{e.hasAttribute("multiple")?t[r].map(e=>o.selected=n.helper.encodeObject(e)===(o.value?o.value:o.innerHTML.trim())):t[r]===(o.value?o.value:o.innerHTML.trim())&&(o.selected=!0)})):void 0===e.value?e.innerHTML=t[r]:e.value=t[r]}))},filterProperties:function(e,t){const r={};return(t=[...arguments]).shift(),t.forEach(t=>{void 0!==e[t]&&(r[t]=e[t])}),r},findParentElementByClass:function(e,t){for(;e&&e.classList&&!e.classList.contains(t);)e=e.parentNode;return e.classList.contains(t)?e:null},format:function(e,t){const r=[[],[],{}],o=n.helper.isObject(e);(t=n.helper.clone([...arguments])).shift(),e=n.helper.stringify(e,(e,t)=>"function"==typeof t?(r[0].push(t),"%$0%"):t);for(let n=0;n<t.length;n++)if("object"==typeof t[n]){for(const a in t[n])if(t[n].hasOwnProperty(a)){if("string"!=typeof t[n][a]&&o&&(r[2][a]=t[n][a],t[n][a]=`%$2%${a}%`),"string"!=typeof t[n][a])continue;e=e.replace(new RegExp(`%${a}%`,"g"),t[n][a].replace(/"/g,'\\"'))}}else"string"!=typeof t[n]&&o&&(r[1].push(t[n]),t[n]="%$1%"),e=e.replace(/%%/,t[n].replace(/"/g,'\\"'));return n.helper.parse(e,(e,t)=>{if("%$0%"===t)return r[0].shift();if("%$1%"===t)return r[1].shift();if("string"==typeof t){if(0===t.indexOf("%$2%")&&""===t.split("%")[3])return r[2][t.split("%")[2]];for(const e in r[2])t=t.replace(new RegExp(`%\\$2%${e}%`,"g"),r[2][e])}return t})},formData:e=>{const t={};return[...e.querySelectorAll("[name]")].map(r=>{let o=r.getAttribute("name");if("checkbox"===r.type){const n=r.checked?"on"===r.value||r.value:"on"!==r.value&&"";[...e.querySelectorAll('[name="'+o+'"]')].length>1?(t[o]||(t[o]=[]),t[o].push(n)):t[o]=n}else if("radio"===r.type)t[o]=r.checked?r.value:t[o]?t[o]:"";else if("select"===r.tagName.toLowerCase()){let e=[];r.hasAttribute("multiple")?[...r.querySelectorAll("option")].map(t=>t.selected&&e.push(t.value?t.value:t.inner)):[...r.querySelectorAll("option")].map(t=>{t.selected&&(e=t.value?t.value:t.inner)}),t[o]=e}else if("number"===r.type||"range"===r.type){let e=parseInt(r.value);isNaN(e)&&(e=""),t[o]=e}else void 0!==r.value?t[o]=r.value:t[r.getAttribute("name")]=r.innerHTML;try{"string"==typeof t[o]&&(n.helper.regex("json").test(t[o])?t[o]=n.helper.decodeObject(t[o]):t[o]=t[o])}catch(e){}}),n.helper.protect(n.helper.solveDotNotation(t))},generateConfig:e=>{e=n.helper.html(e,void 0,{no_evaluation:!0}),n.helper.regex("json").test(e.innerHTML)&&(e.setAttribute("inner",e.innerHTML),e.innerHTML="");const t={};return r(e,t),function(e){if(!e.childNodes)return;if(t.childNodes=[],[...e.childNodes].forEach(a=>{if(a.tagName&&0===a.tagName.indexOf("CCM-")){const s=a.tagName.toLowerCase().split("-");switch(s.length<3&&(s[2]=s[1]),s[1]){case"load":n.helper.deepValue(t,s[2],function(e){let t=function e(t){if(t.hasAttribute("src")){if(0===t.children.length)return t.getAttribute("src");const e={};return[...t.children].forEach(t=>{t.tagName&&0===t.tagName.indexOf("CCM-DATA-")&&(e[t.tagName.toLowerCase().split("-")[2]]=t.getAttribute("value"))}),[t.getAttribute("src"),e]}const r=[];return[...t.children].forEach(n=>{("CCM-SERIAL"===n.tagName&&("CCM-PARALLEL"===t.tagName||0===t.tagName.indexOf("CCM-LOAD"))||"CCM-PARALLEL"===n.tagName&&"CCM-SERIAL"===t.tagName)&&r.push(e(n))}),r}(e);return Array.isArray(t)||(t=[t]),t.unshift("ccm.load"),e.hasAttribute("head")&&t.push(!0),t}(a,s[2]));break;case"component":case"instance":case"proxy":n.helper.deepValue(t,s[2],["ccm."+s[1],a.getAttribute("src")||s[2],n.helper.generateConfig(a)]);break;case"store":case"get":const c={};r(a,c);const i=c.key;delete c.key,n.helper.deepValue(t,s[2],["ccm."+s[1],c,i]);break;case"list":let l=null;[...a.children].forEach(e=>{if(e.tagName&&0===e.tagName.indexOf("CCM-ENTRY")){const t=o(e.getAttribute("value")),r=e.tagName.toLowerCase().split("-");l||(l=r.length<3?[]:{}),r.length<3?l.push(t):n.helper.deepValue(l,r[2],t)}}),l||(l={}),r(a,l),l&&n.helper.deepValue(t,s[2],l);break;default:t.childNodes.push(a),e.removeChild(a)}}else t.childNodes.push(a),e.removeChild(a)}),t.inner)return;t.inner=n.helper.html({}),t.childNodes.forEach(e=>t.inner.appendChild(e)),delete t.childNodes,t.inner.hasChildNodes()||delete t.inner}(e),t;function r(e,t){e.attributes&&[...e.attributes].forEach(r=>{if("src"!==r.name||0!==e.tagName.indexOf("CCM-COMPONENT")&&0!==e.tagName.indexOf("CCM-INSTANCE")&&0!==e.tagName.indexOf("CCM-PROXY"))try{t[r.name]="{"===r.value.charAt(0)||"["===r.value.charAt(0)?n.helper.parse(r.value):o(r.value)}catch(e){}})}function o(e){return"true"===e||"false"!==e&&("null"===e?null:"undefined"!==e?""===e?"":isNaN(e)?e:parseInt(e):void 0)}},generateKey:function(){return Date.now()+"X"+Math.random().toString().substr(2)},getElementID:function(e){return"ccm-"+e.index},getIndex:function(e){if(-1===e.indexOf(".js"))return e;var t=e.split("/").pop();if(!n.helper.regex("filename").test(t))return"";var r=t.split(".");return"ccm"===r[0]&&r.shift(),r.pop(),"min"===r[r.length-1]&&r.pop(),r.join("-")},hasDomContact:e=>document.contains(n.context.root(e).root)&&(n.helper.hasParentContact(e)||!e.parent),hasParentContact:e=>e.parent&&e.parent.element.contains(e.root),hide:function(e){e.element.parentNode.appendChild(n.helper.loading(e)),e.element.style.display="none"},html2json:e=>{const t={inner:[]};if("string"==typeof e){const t=document.createElement("template");t.innerHTML=e,e=t.content}if(window.jQuery&&e instanceof jQuery){e=e.get();const t=document.createDocumentFragment();e.forEach(e=>t.appendChild(e)),e=t}if(e instanceof DocumentFragment){if(!e.children.length)return e.textContent;if([...e.childNodes].forEach(e=>{e.nodeValue&&(e.nodeValue=e.nodeValue.trim(),e.nodeValue&&e.nodeType!==e.COMMENT_NODE||n.helper.removeElement(e))}),"CCM-TEMPLATE"===e.firstChild.tagName){const t=e.firstChild.getAttribute("key")?{}:[];return[...e.childNodes].forEach((e,r)=>{if("CCM-TEMPLATE"!==e.tagName)return;const o=e.getAttribute("key");t[o||r]=e=n.helper.html2json(e),delete e.key,delete e.tag,Array.isArray(e.inner)||(t[o||r]=e.inner)}),t}1===e.childNodes.length&&(e=e.firstChild)}return n.helper.isElementNode(e)?(e.tagName&&(t.tag=e.tagName.toLowerCase()),"div"===t.tag&&delete t.tag,e.attributes&&[...e.attributes].forEach(e=>t[e.name]=""===e.value||e.value),[...e.childNodes].forEach(e=>{e.nodeValue&&(e.nodeValue=e.nodeValue.replace(/\s+/g," ")),(n.helper.isElementNode(e)||e.nodeValue.trim())&&t.inner.push(n.helper.isElementNode(e)?n.helper.html2json(e):e.textContent)}),t.inner.length?1===t.inner.length&&(t.inner=t.inner[0]):delete t.inner,t):e},html:function(e,t,r){let o={};if(n.helper.isObject(r)&&(o=r,r=void 0),e=n.helper.html2json(e),e=n.helper.clone(e),void 0!==t&&(e=n.helper.format.apply(this,arguments)),Array.isArray(e)){const t=[];for(let r=0;r<e.length;r++)t.push(n.helper.html(e[r],void 0,o));return t}if("object"!=typeof e||null===e)return e;const a=document.createElement(n.helper.htmlEncode(e.tag||"div"));delete e.tag,n.helper.regex("json").test(e.key)||delete e.key;for(const t in e){const r=e[t];switch(t){case"async":case"autofocus":case"checked":case"defer":case"disabled":case"ismap":case"multiple":case"required":case"selected":r&&(a[t]=!0);break;case"readonly":r&&(a.readOnly=!0);break;case"inner":if("string"==typeof r||"number"==typeof r){a.innerHTML=r;break}let e=this.html(r,void 0,o);Array.isArray(e)||(e=[e]);for(let t=0;t<e.length;t++)n.helper.isNode(e[t])?a.appendChild(e[t]):a.innerHTML+=e[t];break;default:0===t.indexOf("on")&&"function"==typeof r?a.addEventListener(t.substr(2),r):a.setAttribute(t,n.helper.htmlEncode(r,!0,!1))}}if(a.tagName.startsWith("CCM-")&&!o.no_evaluation){const e=n.helper.generateConfig(a);e.root=a,n.start("CCM-APP"===a.tagName?a.getAttribute("component"):a.tagName.substr(4).toLowerCase(),e)}return n.helper.protect(a)},htmlEncode:function(e,t,r){"string"!=typeof e&&(e=e.toString()),e=t||void 0===t?e.trim():e;var n=document.createElement("span");return n.innerHTML=e,e=n.textContent,e=r||void 0===r?e.replace(/"/g,"&quot;"):e},integrate:async(e,t,r)=>{if(t=n.helper.clone(t),!n.helper.isObject(e))return t;if(!n.helper.isObject(t))return n.helper.clone(e);for(let o in e){const a=o.split(".");let s=t;for(let e=0;e<a.length;e++){const t=a[e];if(n.helper.isDependency(s[t])&&"ccm.get"===s[t][0]&&(s[t]=await n.helper.solveDependency(s[t])),!(s=s[t]))break}r&&void 0!==n.helper.deepValue(t,o)||n.helper.deepValue(t,o,e[o])}return t},isComponent:function(e){return n.helper.isObject(e)&&e.Instance&&!0},isDataset:e=>n.helper.isObject(e)&&n.helper.isKey(e.key),isDatastore:e=>n.helper.isObject(e)&&e.get&&e.set&&e.del&&e.source&&e.clear&&!0,isDependency:function(e){if(Array.isArray(e)&&e.length>0)switch(e[0]){case"ccm.load":case"ccm.component":case"ccm.instance":case"ccm.proxy":case"ccm.start":case"ccm.store":case"ccm.get":case"ccm.set":case"ccm.del":return!0}return!1},isElementNode:function(e){return e instanceof Element||e instanceof DocumentFragment},isFirefox:function(){return navigator.userAgent.search("Firefox")>-1},isFramework:e=>n.helper.isObject(e)&&e.components&&e.version&&!0,isGoogleChrome:function(){return/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)},isInstance:e=>n.helper.isObject(e)&&n.helper.isComponent(e.component)&&e.ccm&&!0,isKey:e=>{if("string"==typeof e)return n.helper.regex("key").test(e);if(Array.isArray(e)){for(let t=0;t<e.length;t++)if(!n.helper.regex("key").test(e[t]))return!1;return!0}return!1},isLoadError:e=>n.helper.isObject(e)&&e.error instanceof Error&&n.helper.isObject(e.resource)&&Array.isArray(e.call)&&e.call.length>=1&&"load"===e.call[0].name,isNode:function(e){return e instanceof Node},isObject:function(e){return"object"==typeof e&&null!==e&&!Array.isArray(e)},isProxy:function(e){return n.helper.isInstance(e)&&!0===e.component},isResourceDataObject:e=>n.helper.isObject(e)&&e.url&&(e.context||e.method||e.params||e.attr||e.ignore_cache||e.type)&&!0,isSafari:function(){return/^((?!chrome|android).)*safari/i.test(navigator.userAgent)},isSpecialObject:e=>!!(e===window||n.helper.isNode(e)||n.helper.isFramework(e)||n.helper.isInstance(e)||n.helper.isComponent(e)||n.helper.isDatastore(e)||window.jQuery&&e instanceof jQuery),isSubset:function(e,t){t=n.helper.toDotNotation(t,!0);for(const r in e)if("object"==typeof e[r]&&"object"==typeof t[r]){if(JSON.stringify(e[r])!==JSON.stringify(t[r]))return!1}else if(e[r]!==t[r])return!1;return!0},loadFramework:async e=>{let t={};n.helper.isObject(e)?(e=n.helper.clone(e),t.url=e.url,delete e.url,t.attr=e):t={url:e};const r=(t.url.match(/(0|[1-9]\d*)\.(0|[1-9]\d*)\.(0|[1-9]\d*)/)||["latest"])[0];return!ccm[r]&&await n.load(t),ccm[r]},loading:function(e){const t=e?e.element.parentNode:document.head;if(!t.querySelector("#ccm_keyframe")){const e=document.createElement("style");e.id="ccm_keyframe",e.appendChild(document.createTextNode("@keyframes ccm_loading { to { transform: rotate(360deg); } }")),t.appendChild(e)}return n.helper.html({class:"ccm_loading",style:"display: grid; padding: 0.5em;",inner:{style:"align-self: center; justify-self: center; display: inline-block; width: 2em; height: 2em; border: 0.3em solid #f3f3f3; border-top-color: #009ee0; border-left-color: #009ee0; border-radius: 50%; animation: ccm_loading 1.5s linear infinite;"}})},log:e=>console.log("[ccm]",e),makeIterable:function(e){return Array.prototype.slice.call(e)},onFinish:async(e,t)=>{const r=e.onfinish;if(!r)return;if(void 0===t&&e.getValue&&(t=e.getValue()),"function"==typeof r)return r(e,t);if("string"==typeof r)return this.executeByName(r,[e,t]);if(r.confirm&&confirm(!r.confirm))return;const o=n.context.find(e,"user");if(r.login&&o&&await o.login(),r.convert&&(t=await r.convert(t)),r.log&&console.log(t),r.clear&&(e.element.innerHTML=""),r.store){const a=n.helper.clone(t);!0===r.store&&(r.store={},n.helper.isObject(e.data)&&n.helper.isDatastore(e.data.store)&&(r.store=n.helper.clone(e.data),r.store.settings=r.store.store.source(),delete r.store.store)),r.store.key&&(a.key=r.store.key),Array.isArray(a.key)||(a.key=[!0!==a.key&&a.key||n.helper.generateKey()]),r.store.user&&o&&o.isLoggedIn()&&a.key.push(o.data().user),r.store.unique&&a.key.push(n.helper.generateKey()),r.store.permissions&&(a._=r.store.permissions),o&&(r.store.settings.user=o),await n.set(r.store.settings,a)}if(r.alert&&alert(r.alert),r.restart&&await e.start(),r.render)if(n.helper.isObject(r.render)&&r.render.component){let t=r.render.config;t||(t={});const o=await n.start(r.render.component,t);n.helper.replace(e.root,o.root)}else n.helper.replace(e.root,n.helper.html(r.render));r.callback&&r.callback(e,t)},parse:(e,t)=>JSON.parse(e.replace(/\\n/g,"\\n").replace(/\\'/g,"\\'").replace(/\\"/g,'\\"').replace(/\\&/g,"\\&").replace(/\\r/g,"\\r").replace(/\\t/g,"\\t").replace(/\\b/g,"\\b").replace(/\\f/g,"\\f").replace(/[\u0000-\u0019]+/g,""),t),prepend:function(e,t){t=n.helper.protect(t),e.hasChildNodes()?e.insertBefore(t,e.firstChild):e.appendChild(t)},privatize:function(e,t){const r=!0===t,o={};if(t&&!r)for(let e=1;e<arguments.length;e++)a(arguments[e]);else for(const t in e)a(t);return o;function a(t){if(!0!==t)switch(t){case"ccm":case"component":case"config":case"data":case"dependency":case"element":case"id":case"index":case"onfinish":case"parent":case"root":break;default:if(n.helper.isInstance(e[t])&&e[t].parent&&e[t].parent.index===e.index)return;if("function"==typeof e[t])return;void 0!==e[t]&&(o[t]=e[t]),r||delete e[t]}}},protect:e=>{if("string"==typeof e)return e.replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,"");if(n.helper.isElementNode(e))[...e.querySelectorAll("script")].forEach(n.helper.removeElement);else if("object"==typeof e&&!n.helper.isSpecialObject(e))for(const t in e)e[t]=n.helper.protect(e[t]);return e},regex:function(e){switch(e){case"filename":return/^ccm\.([a-z][a-z0-9_]*)(-(0|[1-9][0-9]*)\.(0|[1-9][0-9]*)\.(0|[1-9][0-9]*))?(\.min)?(\.js)$/;case"key":return/^[a-zA-Z0-9_-]+$/;case"json":return/^(({(.|\n)*})|(\[(.|\n)*])|true|false|null)$/}},removeElement:e=>e&&e.parentNode&&e.parentNode.removeChild(e),renameProperty:(e,t,r)=>{if(void 0===e[t])return delete e[t];e[r]=e[t],delete e[t]},replace:(e,t)=>e.parentNode&&e.parentNode.replaceChild(n.helper.protect(t),e),setContent:function(e,t){"object"==typeof(t=n.helper.protect(t))?(e.innerHTML="",Array.isArray(t)?t.map(function(t){e.appendChild(t)}):e.appendChild(t)):e.innerHTML=t},show:function(e){e.element.parentNode.removeChild(e.element.parentNode.querySelector(".ccm_loading")),e.element.style.display="block"},shuffleArray:function(e){for(var t=e.length-1;t>0;t--){var r=Math.floor(Math.random()*(t+1)),n=e[t];e[t]=e[r],e[r]=n}return e},sleep:async e=>new Promise(t=>setTimeout(t,e)),solveDependencies:(e,t)=>new Promise((r,o)=>{if(e=n.helper.clone(e),!n.helper.isObject(e)&&!Array.isArray(e))return r(e);let a=!1,s=1;function c(){!--s&&(a?o:r)(e)}!function e(r){if(n.helper.isSpecialObject(r))return;for(const o in r)if(r.hasOwnProperty(o)&&"ignore"!==o){const i=r[o];n.helper.isDependency(i)?(s++,n.helper.solveDependency(r[o],t).then(e=>{r[o]=e,c()}).catch(e=>{a=!0,r[o]=e,c()})):(n.helper.isObject(i)||Array.isArray(i))&&e(i)}}(e),c()}),solveDependency:async(e,t)=>{if(!n.helper.isDependency(e))return e;const r=(e=n.helper.clone(e)).shift().substr("ccm.".length);switch(r){case"load":return t&&function e(r){for(let o=0;o<r.length;o++)Array.isArray(r[o])?e(r[o]):(n.helper.isObject(r[o])||(r[o]={url:r[o]}),r[o].context||(r[o].context=t.element.parentNode))}(e),await n.load.apply(null,e);case"component":case"instance":case"proxy":case"start":case"set":case"del":return e["store"===r?0:1]||(e["store"===r?0:1]={}),e[1]=await n.helper.solveDependency(e[1],t),t&&(e["store"===r?0:1].parent=t),await n[r].apply(null,e);case"store":case"get":return e[0]||(e[0]={}),t&&(e[0].parent=t),await n[r].apply(null,e)}},solveDotNotation:function(e){e=n.helper.clone(e);for(const t in e)-1!==t.indexOf(".")&&(n.helper.deepValue(e,t,e[t]),delete e[t]);return e},stringify:(e,t,r)=>JSON.stringify(e,(e,r)=>(("function"==typeof r||n.helper.isSpecialObject(r))&&(r=null),t?t(e,r):r),r),svg:function(e,t,r){let o={};if(n.helper.isObject(r)&&(o=r,r=void 0),e=n.helper.html2json(e),e=n.helper.clone(e),void 0!==t&&(e=n.helper.format.apply(this,arguments)),Array.isArray(e)){const t=[];for(let r=0;r<html.length;r++)t.push(n.helper.svg(e[r],void 0,o));return t}if("object"!=typeof e||null===e)return e;const a=document.createElementNS("http://www.w3.org/2000/svg",n.helper.htmlEncode(e.tag));delete e.tag,n.helper.regex("json").test(e.key)||delete e.key;for(const t in e){const r=e[t];switch(t){case"async":case"autofocus":case"checked":case"defer":case"disabled":case"ismap":case"multiple":case"required":case"selected":r&&(a[t]=!0);break;case"readonly":r&&(a.readOnly=!0);break;case"inner":if("string"==typeof r||"number"==typeof r){a.innerHTML=r;break}let e=this.svg(r,void 0,o);Array.isArray(e)||(e=[e]);for(let t=0;t<e.length;t++)n.helper.isNode(e[t])?a.appendChild(e[t]):a.innerHTML+=e[t];break;default:0===t.indexOf("on")&&"function"==typeof r?a.addEventListener(t.substr(2),r):a.setAttribute(t,n.helper.htmlEncode(r,!0,!1))}}if(a.tagName.startsWith("CCM-")&&!o.no_evaluation){const e=n.helper.generateConfig(a);e.root=a,n.start("CCM-APP"===a.tagName?a.getAttribute("component"):a.tagName.substr(4).toLowerCase(),e)}return n.helper.protect(a)},toDotNotation:function(e,t){const r={};return function e(n,o){for(const a in n)"object"==typeof n[a]?(t&&(r[o+a]=n[a]),e(n[a],o+a+".")):r[o+a]=n[a]}(e,""),r},toJSON:e=>n.helper.parse(n.helper.stringify(e)),transformStringArray:function(e){var t={};return e.map(function(e){t[e]=!0}),t},unescapeHTML:e=>{const t=document.createElement("div");return e.replace(/\&[#0-9a-z]+;/gi,e=>(t.innerHTML=e,t.innerText))},wait:function(e,t){window.setTimeout(t,e)}}};async function o(e){"customElements"in window||await n.load({url:"https://ccmjs.github.io/ccm/polyfills/webcomponents-lite.js",attr:{integrity:"sha384-yEuTKRGFLhOAfHNxaZiiI23KhMelYudrPUNSUK6T5u1+deGEEKsQ89cS0sPIHjyj",crossorigin:"anonymous"}}),customElements.get("ccm-"+e)||window.customElements.define("ccm-"+e,class extends HTMLElement{async connectedCallback(){if(!document.body.contains(this))return;let t=this;for(;t=t.parentNode;)if(t.tagName&&0===t.tagName.indexOf("CCM-"))return;await n.helper.sleep(0);const r=n.helper.generateConfig(this);this.removeAttribute("key"),r.root=this,await n.start("CCM-APP"===this.tagName?this.getAttribute("component"):e,r)}})}async function a(e={},t={}){e=await n.helper.solveDependency(e);let r=t;return r=await n.helper.integrate(await n.helper.solveDependency(e.key),r),delete(r=await n.helper.integrate(e,r)).key,delete r.component,r}n.load.timeout=0,n.version&&!ccm[n.version()]&&(ccm[n.version()]=n),(!ccm.version||n.helper.compareVersions(n.version(),ccm.version())>0)&&(ccm.latest=n,Object.assign(ccm,n.helper.clone(n))),o("app")})();